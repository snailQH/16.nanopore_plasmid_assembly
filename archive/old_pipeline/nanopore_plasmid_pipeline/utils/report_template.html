<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nanopore Plasmid Pipeline Report</title>
    <style>
        body { font-family: sans-serif; margin: 2em; }
        h1, h2, h3 { color: #333; }
        .section { border: 1px solid #ddd; padding: 1em; margin-bottom: 1em; border-radius: 5px; }
        .grid-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1em; }
        .grid-item { border: 1px solid #eee; padding: 1em; }
        img { max-width: 100%; height: auto; display: block; margin: 0 auto; }
        pre { background-color: #f4f4f4; padding: 1em; white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body>
    <h1>Nanopore Plasmid Assembly Report</h1>
    <div class="section">
        <h2>Run Summary</h2>
        <p><strong>Input FASTQ:</strong> {{ run_args.input }}</p>
        <p><strong>Output Directory:</strong> {{ run_args.output }}</p>
        <p><strong>Pipeline Start Time:</strong> {{ time }}</p>
        <p><strong>Threads:</strong> {{ run_args.threads }}</p>
        <p><strong>Expected Plasmids:</strong> {{ run_args.expected_plasmids }}</p>
    </div>

    <div class="section">
        <h2>Assembly & Polishing Summary</h2>
        <div class="grid-container">
            <div class="grid-item">
                <h3>Flye Assembly Info</h3>
                <pre>{{ assembly_info }}</pre>
            </div>
            <div class="grid-item">
                <h3>Assembly Validation (Flagstat)</h3>
                <pre>{{ flagstat_report }}</pre>
            </div>
        </div>
    </div>

    <div class="section">
        <h2>Visualizations</h2>
        <div class="grid-container">
            <div class="grid-item">
                <h3>Read Length Histogram</h3>
                <img src="data:image/png;base64,{{ read_length_plot_b64 }}" alt="Read Length Histogram">
            </div>
            <div class="grid-item">
                <h3>Virtual Gel</h3>
                <img src="data:image/png;base64,{{ virtual_gel_plot_b64 }}" alt="Virtual Gel">
            </div>
        </div>
    </div>

    {% for contig in contigs %}
    <div class="section">
        <h2>Contig: {{ contig.id }} ({{ contig.length }} bp)</h2>
        <div class="grid-container">
            {% if contig.coverage_plot_b64 %}
            <div class="grid-item">
                <h3>Coverage Plot</h3>
                <img src="data:image/png;base64,{{ contig.coverage_plot_b64 }}" alt="Coverage plot for {{ contig.id }}">
            </div>
            {% endif %}
            {% if contig.pileup_plot_b64 %}
            <div class="grid-item">
                <h3>Alignment Pileup</h3>
                <img src="data:image/png;base64,{{ contig.pileup_plot_b64 }}" alt="Alignment pileup for {{ contig.id }}">
            </div>
            {% endif %}
            {% if contig.plasmid_map_b64 %}
            <div class="grid-item">
                <h3>Plasmid Map</h3>
                <img src="data:image/png;base64,{{ contig.plasmid_map_b64 }}" alt="Plasmid map for {{ contig.id }}">
            </div>
            {% endif %}
        </div>
        {% if contig.annotation_gff %}
        <div class="grid-item">
            <h3>Annotation (GFF)</h3>
            <pre>{{ contig.annotation_gff }}</pre>
        </div>
        {% endif %}
    </div>
    {% endfor %}

</body>
</html> 